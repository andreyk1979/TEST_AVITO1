# ВНИМАНИЕ!!! ЭТО ПРИМЕР ДОКУМЕНТАЦИИ
#ВАМ ТОЖЕ ОЧЕНЬ ПРИГОДИТСЯ

## Сущности

[Схема базы данных](https://dbdiagram.io/embed/614c9d0e825b5b0146107aac)

```
* - поля ссылающиеся на другие Entity;
** - поля ссылающиеся на Enum.
```

### Address:

#### Поля:

- **id** - уникальный идентификационный номер адреса;
- **cityIndex** - поле хранящее почтовый индекс;
- **country** - поле хранящее Страну*;
- **city** - поле хранящее Город*;
- **street** - поле хранящее название улицы;
- **house** - поле хранящее дом (String);
- **user** - поле связывающие адрес с конкретным Пользователем*.

```
Сущность представляет собой набор данных предназначенных для определения 
адреса доставки заказа/ расположения магазина / расположения пользователя.
```

### CartItem:

#### Поля:

- **id** - уникальный идентификационный номер карточки товара;
- **item** - поле хранящее выбранный Товар*;
- **shop** - поле хранящее Магазин* в котором был выбран товар;
- **user** - поле хранящее Пользователя* который выбрал товар;
- **quantity** - поле хранящее количество товаров.

#### Методы:

- **getSubTotal()**- метод который подсчитывает стоимость товара на основании предоставленной скидки и количества
  выбранного товара.


### Basket

#### Поля

- **id** - id корзины, таблицей не назначается, является `MapsId` User
- **basketOwner** - владелец корзины, ссылка на `User`
- **basketCountItems** - `Map` хранит пары `Item: Integer` (товар: кол-во в заказе) 

```
Сущность для работы с корзиной, хранит данные владельца корзины и детализацию товаровв ней, учитывая количество 
конкретной позиции в корзине. 
```
#### Логика работы:

### Логика работы корзины по запросам на контроллеры:

- http://localhost:8888/basket/ get обычный контроллер - страница basket.html (внутри User, Basket)
---

- http://localhost:8888/api/basket/items/ get rest - возвращает упрощенное содержание корзины {id: count} Кнопка `Обновить`
---

- http://localhost:8888/api/basket/rests/ get rest - на вход :
```json
[
   {
      "id": 1
   },
] 
```
```
Возвращает актуальные остатки по Item по указанным id. Нужен для реакции на ошибки валидации (выдать юзеру сколько он 
может положить в корзину или исправить вместо него)
```
---

- http://localhost:8888/api/basket/items/ put rest - на вход - текущее состояние корзины
```json
[
    {
        "countInBasket": 5,
        "item": {
            "id": 1
        }
    },
]
```
```
Проверяет, что countInBasket не больше текущего остатка и пишет в базу полученные значения (Basket),
на ошибку выдаст подробное описание валидации по полям. Этим Методом записываем всю корзину в базу 
(кнопка `Сохранить`, при уходе со страницы или перед заказом). Все старые значения из корзины будут перезаписаны.
```
---

- http://localhost:8888/api/basket/item/ - put rest - на вход:
``` json
{
    "countInBasket": 1,
        "item": {
            "id": 9
        }
}
```
```
Проверяет что countInBasket не больше текущего остатка и не станет больше при добавлении, пишет в базу полученное
значение (в сущность Basket). Метод прибаляет колличество в корзине по конкретной позиции к уже имеющемуся 
(или создаст новую). Кнопока `Добавить к корзину` при нажатии несколько раз - будет добавлять, пока не будет ошибки валидации.
```
---
- http://localhost:8888/api/basket/item/dec` 
```
Обратный методу `add` при сокращении до 0 удалит позицию. Валидирует только отриц значения, любое кол > остака - 
удалит позицию.
```
---

- http://localhost:8888/api/basket/item/ delete rest - на вход:
```json
{
    "id": 2
}
```
--- 
```
удаляет позицию из корзины - кнопка `очистить`
```
- http://localhost:8888/api/basket/items delete rest - полностью очистит корзину (НЕ удаляет саму корзину от юзера)

---
```
Корзину для юзера специально нигде создавать не нужно, она автоматом привязывается к нему при создании (юзера).  
Id корзины - это внешний ключ от юзера. Саму корзину удалить с Фронта нельзя. Корзина реализована через
 `Map<Item, Integer>` (позиция, количество) . Преобразуется  до Дто через вспомогательную сущность ItemCountPosition
 (в базе ее нет).
```
